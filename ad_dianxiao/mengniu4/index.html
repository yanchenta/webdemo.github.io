
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0,  minimum-scale=1.0, maximum-scale=1.0" />
        <title></title>
        <link href="css/index.css"  type="text/css" rel="stylesheet" />
        
        <script src="js/jquery.min.js"></script>
        <script src="js/easing.js"></script>
        <script>
			window.onload = function(){
				
				addListener();
				
			}
			
			function showPop(){
				$('.mark,.animate').show();
				
			}
			
			function closePop(){
				$('.step1').show();
				isMove = false;
				$('.mark,.animate,.step2,.step3,.step4,.step5,.step6,.step7').hide();
				addListener();
			}

			
			function choujiang(){
				play(getResult(50));
				return;
				
			}
			
			var _r = 3;
			function getResult(a){
				var b = '4';
				
				return b;
			}
			var isBegin = false;
			function play(result){
				var u = $(".num").width();
				
				if(isBegin) return false;
				isBegin = true;
				$(".num").css('backgroundPositionY',0);
				var num_arr = (result+'').split('');
				$(".num").each(function(index){
					var _num = $(this);
					setTimeout(function(){
						_num.animate({ 
							backgroundPositionY: (u*300) - (u*num_arr[index])
						},{
							duration: 6000+index*3000,
							easing: "easeOutExpo",
							complete: function(){
								if(index==0){
									isBegin = false;
									setTimeout(function(){
										$('.step7').show();
									},800);
								}
								
							}
						});
					}, index * 100);
				});
			}
			
			//开始动画
			var isMove = false;
			function beginAnimation(){
				
				if(!isMove){
					isMove = true;
					$('.step1').hide();
					$('.step2').show();
					setTimeout(function(){
						$('.step3').show();
					},400);
					setTimeout(function(){
						$('.step4').show();
					},700);
					setTimeout(function(){
						$('.step1,.step3,.step4').hide();
						$('.step6').show();
						
						setTimeout(function(){
							$('.step5').show();
							choujiang();
						},800);
					},1000);
				}
				
			}
        
		//摇一摇

	var animationTimer;
	var shake = false, shaked = false;
	var SHAKE_THRESHOLD = 800;
	var x, y, z, last_x, last_y, last_z, lastUpdate = 0;
	var canShake = true;
	var currentTimes;
	
	function addListener() {
		if (window.DeviceMotionEvent) {
				window.addEventListener('devicemotion', deviceMotionHandler, false);
				return true;
	
		} else if (window.DeviceOrientationEvent) {
			window.addEventListener("deviceorientation", deciceOrientationHandler, false);
			return true;
		} else {
			return false;
		}
	}
	
	function removeListener() {
		if (window.DeviceMotionEvent) {
			window.removeEventListener("devicemotion", deviceMotionHandler,false);
	
		} else if (window.DeviceOrientationEvent) {
			window.removeEventListener("deviceorientation", deciceOrientationHandler,false);
		}
	}
	
	function deciceOrientationHandler(eventData) {
		
		var curTime = new Date().getTime();
		if ((curTime - lastUpdate) > 100) {
			var diffTime = (curTime - lastUpdate);
			lastUpdate = curTime;
			x = eventData.alpha;
			y = eventData.beta;
			z = eventData.gamma;
			var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 1000;
			if (speed > SHAKE_THRESHOLD) {
				shaked = true;
			} else {
				if (shaked) {
					shaked = false;
					if(canShake){
						//removeListener();
						setTimeout(setanimation, 500);
					}
					
				}
			}
			last_x = x;
			last_y = y;
			last_z = z;
		}
	}
	
	function deviceMotionHandler(eventData) {
		//alert('yaoyiyao aa');
		var acceleration = eventData.accelerationIncludingGravity;
		var curTime = new Date().getTime();
		if ((curTime - lastUpdate) > 100) {
			var diffTime = (curTime - lastUpdate);
			lastUpdate = curTime;
			x = acceleration.x;
			y = acceleration.y;
			z = acceleration.z;
			
			var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 10000;
			if (speed > SHAKE_THRESHOLD) {
				shaked = true;
			} else {
				if (shaked) {
					shaked = false;
					if(canShake){
						//removeListener();
						setTimeout(setanimation, 500);
					}
				}
			}
			last_x = x;
			last_y = y;
			last_z = z;
		}
	}
	
	function setanimation(){
		removeListener();
		showPop();
	}
		
        </script>
    </head>
    
    <body>
    	
         <div class="container">
        	
            <div id="logo"></div>
            <div id="area" onClick="showPop();"></div>
            <div id="mobile"></div>
            
            <div class="mark" style="display:none;"></div>
            <div class="animate" style="display:none;">
            	<a class="close" href="javascript:;" onclick="closePop();">关闭</a>
            
            	<div class="bg" onClick="beginAnimation()"><img src="images/bg.png" alt="" /></div>
                <div class="step step1" onClick="beginAnimation()"><img src="images/a1.png" alt="" /></div>
                <div class="step step2" style="display:none;"><img src="images/b1.png" alt="" /></div>
                <div class="step step3" style="display:none;"><img src="images/b2.png" alt="" /></div>
                <div class="step step4" style="display:none;"><img src="images/b3.png" alt="" /></div>
                <div class="step step5" style="display:none;">
                	<div class="num"></div>
                </div>
                <div class="step step6" style="display:none;"><img src="images/b4.png" alt="" /></div>
                <div class="step step7" style="display:none;"><a href="http://www.mengniu.com.cn/"><img src="images/b5.png" alt="" /></a></div>
            </div>
            
            
            
        </div>
        
    </body>
</html>
