
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0,  minimum-scale=1.0, maximum-scale=1.0" />
<meta name="keywords" content="">
<meta name="description" content="">
<title></title>
<link href="css/index.css"  type="text/css" rel="stylesheet" />
<script src="channel.js"></script>
<script src="js/jquery-1.4.4.min.js"></script>
<script src="js/jquery.cookie.js"></script>
<script src="js/jquery.xml2json.js"></script>
<script src="js/iscroll.js"></script>
<script src="js/guid.js"></script>
<script src="js/trackEvent.js"></script>
<script src="js/control.js"></script>
<script src="js/canvas.js"></script>
<style>
html,body{background-color:#f1d5c2;}
</style>
<script>

var yeyeye = false;
var myCanvas, timer, uid = request("uid");
var trophyRecordid;
var _userinfo;
$(document).ready(function (e) {
	
    
});
function guagua_ok() {
    $("#qujiang").show();
}
function guagua_no() {
    $("#youhui").show();
}
	
function step1(){
	var para = {description:trim($('#pihua').val()),realname:trim($('#chuohao').val())};
	if(!para.description){
		alert("写点什么吧~");
		return;
	}
	if(!para.realname){
		alert("留下您的大名吧");
		return;
	}
	
	$.ajax({
		url: action_url + "/advmessage/adv/addResultJsonP.action?expand2=1&advid=" + advid,
		cache: false,
		dataType: 'jsonp',
		jsonpCallback: "eventcallback_m1_1",
		timeout: 3500,
		data : para,
		success: function (data) {
			if (data[0].success == 1) {
				
			} else {
				
			}
			
		},
		error: function () {

		}
	});
	
	$(".step").hide();
	$("#step2").show();
	step2();
}
function step2(){
	myCanvas = new MyCanvas('canvas');
    myCanvas.drawImage('images/p2.png');
    myCanvas.isEraser = true;
    timer = setInterval(removeCanvas, 1000);
    function removeCanvas() {
        if (myCanvas.checkCleared()) {
            clearInterval(timer);
            myCanvas.remove();
            //var img= new Image();
            //img.src="images/ok.png";			 
            myCanvas.clearAll();
            yeyeye ? guagua_ok() : guagua_no();
        }
    }
	_userinfo = Guid.NewGuid().ToString();
    if (!0) {

        $.ajax({
            url: action_url + "/advmessage/trophy/awardJsonP.action?advid=" + advid,
            cache: false,
            dataType: 'jsonp',
            jsonpCallback: "eventcallback_m1_2",
            timeout: 3500,
			data : {userinfo:_userinfo},
            success: function (data) {
                if (data[0].success == 1 && data[0].award == 1) {		//中奖
                    trophyRecordid = data[0].prize.recordid;
                    $("#canvas").css("background-image", "url(images/p3.png)");
                    yeyeye = true;
                } else {	//没中奖
                    $("#canvas").css("background-image", "url(images/p5.png)");
                    yeyeye = false;
                }
            },
            error: function () {
                $("#canvas").css("background-image", "url(images/p5.png)");
                yeyeye = false;

            }
        });
    } else {
        $("#canvas").css("background-image", "url(images/p5.png)");
        yeyeye = false;
    }
}
function step3(){
	$(".step").hide();
	$("#step3").show();
}
function step4(){
	$(".step").hide();
	$("#step4").show();
}
var _IsSubmit5 = false;
function step5(){
	if(_IsSubmit5){
		return;
	}
	_IsSubmit5 = true;
	var para = {trophyRecordid:trophyRecordid,uid:_userinfo,mobile:trim($('#mobile').val()),realname:trim($('#name').val()),cityname:trim($('#address').val())};
	if(!para.realname){
		alert("请填写您的名字");
		_IsSubmit5 = false;
		return;
	}
	if(!matchMobile(para.mobile)){
		alert("请填写正确的手机号码");
		_IsSubmit5 = false;
		return;
	}
	if(!para.cityname){
		alert("请填写您的地址");
		_IsSubmit5 = false;
		return;
	}
	
	$.ajax({
		url: action_url + "/advmessage/adv/addResultJsonP.action?advid=" + advid,
		cache: false,
		dataType: 'jsonp',
		jsonpCallback: "eventcallback_m1_3",
		timeout: 3500,
		data : para,
		success: function (data) {
			if (data[0].success == 1) {
				alert("提交成功！");
				location = "index.html"
			} else {
				alert(data[0].info);
			}
			_IsSubmit5 = false;
		},
		error: function () {

		}
	});
}
</script>
</head>

<body onclick="$('#nav,#v2,#v3').hide();">
<div class="fxbg">
	<img class="img" src="images/2.jpg" alt=""/>
	<div class="btn1">
		<div id="step1" class="step">
			<img class="img fly bigpic" src="images/p1.png" alt=""/>
			<textarea class="fly" id="pihua" placeholder="点击输入对“TA”1314的宣言 "></textarea>
			<input type="text" class="fly" id="chuohao" />
			<img class="img fly btnpic" src="images/btn1.png" alt="" onclick="step1()"/>
		</div>
		<div id="step2" class="step" style="display:none;">
			<canvas id="canvas" class="fly bigpic"></canvas>
			<div id="youhui" class="fly" onclick="step4()" style="display:none;"></div>
			<img id="qujiang" class="img fly btnpic" src="images/btn2.png" alt="" onclick="step3()" style="display:none;"/>
		</div>
		<div id="step3" class="step" style="display:none;">
			<img class="img fly bigpic" src="images/p4.png" alt=""/>
			<input type="text" class="fly" id="name" placeholder="姓名"/>
			<input type="tel" class="fly" id="mobile" placeholder="电话"/>
			<textarea class="fly" id="address" placeholder="地址"></textarea>
			<img id="qujiang" class="img fly btnpic" src="images/btn3.png" alt="" onclick="step5()"/>
		</div>
		<div id="step4" class="step" style="display:none;" onclick="$('.step').hide();$('#step2,#youhui,#canvas').show();">
			<div id="cover" class="fly"></div>
			<img id="quan" class="img fly bigpic" src="images/quan.png" alt=""/>
		</div>
		<img class="img fly" src="images/nav.png" alt="" id="nav"/>
		<a href="index.html" id="m1" class="fly"></a>
		<a href="m2.html" id="m2" class="fly"></a>
		<a href="m3.html" id="m3" class="fly"></a>
		<a href="http://a1783.oadz.com/link/C/1783/1250/KxhQqHV7AvvSOwSgS0xVILbhJ2s_/p01b/0/http://www.ctfeshop.com.cn/" id="v2" class="fly"></a>
	<a href="m4.html" id="v3" class="fly"></a>
    <a href="javascript:$('#nav,#v2,#v3').show();" id="m4" class="fly"></a>
	</div>
</div>
</body>
</html>
