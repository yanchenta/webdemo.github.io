
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0,  minimum-scale=1.0, maximum-scale=1.0" />
<meta name="keywords" content="">
<meta name="description" content="">
<title></title>
<link href="css/index.css"  type="text/css" rel="stylesheet" />
<script src="channel.js"></script>
<script src="js/jquery-1.4.4.min.js"></script>
<script src="js/jquery.cookie.js"></script>
<script src="js/iscroll.js"></script>
<script src="js/guid.js"></script>
<script src="js/trackEvent.js"></script>
<script src="js/control.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
<style>
html,body{background-color:#f1d5c2;}
</style>
<script>
var map;var g;var position;var userInfo = {};
$(document).ready(function(e) {
	
	
	g = new BMap.Geolocation();
	g.getCurrentPosition(getCurrentPositionCallback,{timeout:4000});
	//track(channel,5449);
});
function getCurrentPositionCallback(gr) {				
	map = new BMap.Map('baidu_map');
	
	if(gr){
		map.centerAndZoom(gr.point, 15);
		position = gr.point;
		
			var iconEnd = new BMap.Icon("images/my.png", new BMap.Size(20,20), {anchor:new BMap.Size(10,10)});
			var markerEnd = new BMap.Marker(position,{icon:iconEnd}); 
			map.addOverlay(markerEnd);
			
		map.setCenter(position);
		userInfo.lng = position.lng;
		userInfo.lat = position.lat;
		userInfo.radius = 16000;
		
		getDealer();
	}else{
		//$(".graddress").text("无法获取您的当前位置");
		
		new BMap.LocalCity().get(function(city){
			map.centerAndZoom(city.name,14);
			position = city.center;
			userInfo.lng = city.center.lng;
			userInfo.lat = city.center.lat;
			userInfo.radius = 20000;
			
			getDealer();
		});
	}
	
	//_ols = [];
	
}
function getDealer(){
	$.ajax({
		url : action_url + '/advmessage/dealer/getDealerJsonP.action?advid=' + advid,
		cache : false,
		dataType : 'jsonp',
		jsonpCallback : "eventcallback_m4",
		data : userInfo,
		success : function(json) {
			var arr = json[0];
			var html = "";
			for(var i=0;i<arr.length;i++){
				var gpoint = new BMap.Point(arr[i].longitude,arr[i].latitude);
								
					var iconEnd = new BMap.Icon("images/map_logo.png", new BMap.Size(30,45), {anchor:new BMap.Size(15,45)});
					var markerEnd = new BMap.Marker(gpoint,{icon:iconEnd}); 
					/*
					info.point = point;
					markerEnd.info = info;
					markerEnd.addEventListener("click",function(){
						showInfo(this.info.dealerName,this.info.dealerAddress,point);
					});
					
					
					_ols.push(markerEnd);
					*/
				map.addOverlay(markerEnd);
			}
		}
	});
}
</script>
</head>

<body onclick="$('#nav,#v2,#v3').hide();">
<div class="fxbg">
<img class="img" src="images/5.jpg" alt=""/>
<div class="btn1">
	<div id="baidu_map" class="fly"><br/><br/>正在获取您的位置，请在弹出提示中点击确认。</div>
	
	<img class="img fly" src="images/nav.png" alt="" id="nav"/>
	<a href="index.html" id="m1" class="fly"></a>
    <a href="m2.html" id="m2" class="fly"></a>
    <a href="m3.html" id="m3" class="fly"></a>
    <a href="http://a1783.oadz.com/link/C/1783/1250/KxhQqHV7AvvSOwSgS0xVILbhJ2s_/p01b/0/http://www.ctfeshop.com.cn/" id="v2" class="fly"></a>
	<a href="m4.html" id="v3" class="fly"></a>
    <a href="javascript:$('#nav,#v2,#v3').show();" id="m4" class="fly"></a>
</div>
</div>
</body>
</html>
