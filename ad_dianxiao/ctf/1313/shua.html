
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0,  minimum-scale=1.0, maximum-scale=1.0" />
<meta name="keywords" content="">
<meta name="description" content="">
<title></title>
<script src="jquery-min.js"></script>
    <script src="guid.js"></script>
<script>
var action_url = "http://track.mobile1.com.cn";
var advid = 10022;
var count = 0;
var run = false;
var trophyRecordid;
var _userinfo;
var pihuas = [];
var names = [];
function k(){
    run = true;
    c();
}

function c(){
    _userinfo = Guid.NewGuid().ToString();
    $.ajax({
            url: action_url + "/advmessage/trophy/awardJsonP.action?advid=" + advid,
            cache: false,
            dataType: 'jsonp',
            jsonpCallback: "eventcallback_m1_2" + count,
            timeout: 3500,
			data : {userinfo:_userinfo},
            success: function (data) {
                count ++;
                $("#count").text(count);
                if (data[0].success == 1 && data[0].award == 1) {		//中奖
                    trophyRecordid = data[0].prize.recordid;
                    $("#trophyRecordid").text(trophyRecordid);
                    $("#userinfo").text(_userinfo);
                    run = false;
                }else{
                    if(run){
                        setTimeout('c()',100);
                    }
                }
            },
            error: function () {
            }
        });

}
function t(){
    run = false;
}
function y(){
	var para = {trophyRecordid:trophyRecordid,uid:_userinfo,mobile:trim($('#mobile').val()),realname:trim($('#name').val()),cityname:trim($('#address').val())};
	if(!para.realname){
		alert("请填写您的名字");
		return;
	}
	if(!matchMobile(para.mobile)){
		alert("请填写正确的手机号码");
		return;
	}
	if(!para.cityname){
		alert("请填写您的地址");
		return;
	}
	
	$.ajax({
		url: action_url + "/advmessage/adv/addResultJsonP.action?advid=" + advid,
		cache: false,
		dataType: 'jsonp',
		jsonpCallback: "eventcallback_ma",
		timeout: 3500,
		data : para,
		success: function (data) {
			if (data[0].success == 1) {
				alert("提交成功！");
			} else {
				alert(data[0].info);
			}
		},
		error: function () {

		}
	});

}
function trim(str){ //删除左右两端的空格
	return str.replace(/(^\s*)|(\s*$)/g, "");
}
function ltrim(str){ //删除左边的空格
	return str.replace(/(^\s*)/g,"");
}
function rtrim(str){ //删除右边的空格
	return str.replace(/(\s*$)/g,"");
}

function matchUserName(val){
	var valnew = trim(val);
	var re1=/^[~!@#$%^&*()-+={}|;:<>?.,~！@#￥……&*（）+=｛｝【】|、：；"'《》、？，。]/i;
	if(valnew == ""){
		return false;
	}
	if(re1.test(valnew)){
		return false;
	}
	if(valnew.length<2||valnew.length>20){
		return false;
	}
}

function matchEmail(val){
	var valnew = trim(val);
	if(valnew.match( /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/)){
		return true;
	}else{
		return false;
	}
}

function matchMobile(val){
	var valnew = trim(val);
	if(valnew.match(/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/)){
		return true;
	}else{
		return false;
	}
}
$(document).ready(function(){
   
});
</script>
</head>

<body>
    <label id="count">0</label><br/>
    <input type="button" onclick="k()" value="start" /><input type="button" onclick="t()" value="stop" /><br/><br/>
    <label id="trophyRecordid"></label><br/>
    <label id="userinfo"></label><br/>
    <input type="text" class="fly" id="name" placeholder="姓名"/><br/>
	<input type="tel" class="fly" id="mobile" placeholder="电话"/><br/>
	<textarea class="fly" id="address" placeholder="地址"></textarea><br/>
	<input type="button" onclick="y()" value="submit" />
</body>
</html>
