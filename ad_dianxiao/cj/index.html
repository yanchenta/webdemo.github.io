<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
    	<title>安沃传媒</title>
        <link rel="stylesheet" type="text/css" href="css/reset.css">
        <link rel="stylesheet" type="text/css" href="css/index.css">
        <script src="js/jquery-1.4.4.min.js"></script>
        <script src="js/trackEvent.js"></script>
        <script>
			function sendInfo(){
				var name = $.trim($('#name').val());
				var code = $.trim($('#code').val());
				if(name==""){
					alert('请输入您的开发者账号');
					return;
				}
				if(code==''){
					alert('请输入您的兑奖码');
					return;
				}
				
				//var url = "http://ama.adwo.com/advmessage/advpoints/addRankJsonP.action?advid=30064";
				var url = "http://ama.adwo.com/advmessage/adv/addResultJsonP.action?advid=30064";
				$.ajax({
					url: url,
					cache: false,
					dataType : 'jsonp',
					jsonpCallback: "eventcallback4",
					data:{
						realname : name,
						expand1 : code,
					},
					success: function(json) {
						if (json[0].success == 1) {
							$('#code').val('');
							
							var resultid = json[0].id;
							
							
							//抽奖
							$.ajax({
								url: "http://ama.adwo.com/advmessage/ylbtrophy/awardJsonP.action?advid=30064",
								cache: false,
								dataType : 'jsonp',
								jsonpCallback: "eventcallback5",
								data:{
									userinfo : name,
									code : code,
									resultid : resultid,
								},
								success: function(data) {
									if (data[0].success == 1&&data[0].award==1) {
										switch(data[0].prizeid){
											case 42 :
												$('#precent').html('<img src="images/p20.png" alt />');
												break;
											case 43 :
												$('#precent').html('<img src="images/p15.png" alt />');
												break;
											case 44 :
												$('#precent').html('<img src="images/p10.png" alt />');
												break;
											case 45 :
												$('#precent').html('<img src="images/p5.png" alt />');
												break;
											
										}
										$('#name').val('');
										$('.pop').show();
										
										
									}
									else if(data[0].success == 1&&data[0].award==0&&data[0].state==1){
										alert('您输入的兑奖码已使用过');
									}else if(data[0].state ==3){
										alert('您输入的兑奖码错误');
									}else if(data[0].state ==4){
										alert('一个开发者账号只能兑奖两次');
									}else if(data[0].state ==5){
										alert('一个月一个开发者账号只能兑奖一次');
									}else{
										alert('抽奖失败哦~');
									}
								}
							});
							
						}
						else{
							alert('提交失败');
						}
					}
				});
				
			}
			
			function resetPage() {
				var deviceWidth = document.documentElement.clientWidth,
				scale = deviceWidth/320;
				document.body.style.zoom = scale;
			}
			
			window.onresize = function(){
				resetPage();
			}

			$(function(){
				resetPage();
			});

			function closePop(){
				$('.pop').hide();
				$('#precent').html('');
			}
			
        </script>
    </head>
    
    <body>
    
    	<div class="container">
        	
            <figure><img src="images/index.jpg" alt="" /></figure>
          	
            <div id="form">
            	<input type="text" class="posi" id="name" />
                <input type="tel" class="posi" id="code" />
                <p class="posi sub"><a href="javascript:sendInfo();">提交</a></p>
            </div>
           
           
           <div class="pop" style="display:none;">
           		<div class="mark"></div>
                <div class="popcon">
                	<a href="javascript:closePop();"><img src="images/close.png" alt="" /></a>
                	<figure><img src="images/succ.png" alt="" /></figure>
                    <figure id="precent"></figure>
                </div>
           </div>
           
        </div>
	
    </body>

</html>
