<!DOCTYPE html>
<html>
<head>
    <title>RedBullWorldCup</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script type="text/javascript">
        var phoneWidth =  parseInt(window.screen.width);
        var phoneScale = phoneWidth/640;
        var ua = navigator.userAgent;
        if (/Android (\d+\.\d+)/.test(ua)){
            var version = parseFloat(RegExp.$1);
            // andriod 2.3
            if(version>2.3){
                document.write('<meta name="viewport" content="width=640, minimum-scale = '+phoneScale+', maximum-scale = '+phoneScale+', target-densitydpi=device-dpi">');
                // andriod 2.3以上
            }else{
                document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">');
            }
            // 其他系统
        } else {
            document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">');
        }
        //微信去掉下方刷新栏
        if(RegExp("MicroMessenger").test(navigator.userAgent)){
            document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
                WeixinJSBridge.call('hideToolbar');
            });
        }
    </script>
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <script src="js/jquery-2.1.0.min.js"></script>
    <script src="js/client.js"></script>
    <script src="js/cookie/jquery.cookie.js"></script>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=679e8396eb71ff4d1771a9846b3e31b7"></script>
    <script src="js/user.js"></script>
</head>
<body>
<section class="body2">
    <section class="BG">
        <section class="login">
            <!--登陆前-->
            <article class="T" id="loginbefore"></article>
            <!--登陆后-->
            <article class="img Dn" id="loged"><img src="" width="70" height="70"></article>
            <!--退出-->
            <article class="userOut Dn" id="userOut"><img src="img/userOut.png" width="70" height="70" onClick="userOut()"></article>
        </section>
        <article class="rankmap">

            <!--传球圈-->
            <section class="passBall">
                
                <article id="jh" class="map_passball" style="text-align:center;display:none;">
                    <span class="passRank" id="nono"></span> 的最多传球:<span class="passNum" id="cq"></span>
                </article>
                <article class="map_zhao">
                    <section class="map" style="width:100%;height:100%;border:0px solid gray; background:#F9F;" id="allmap">
                    </section>
                </article>
            </section>
            <a href="rank.html">
                <footer class="foot"></footer>
            </a>
        </article>
    </section>
</section>
</body>
</html>
<script>
if($.cookie('req')==2 || $.cookie('req')=='2')
	{
		$("#jh").show();
	}
var userInfo = eval('(' + $.cookie('userInfo') + ')');
uid = userInfo.uid;

name = userInfo.name;
head = userInfo.head;
var beijingPosition = new Array();
var beijingPositions = '';
var position = [];
var points = [];
//if($.cookie('open')!='' && $.cookie('open')!=undefined)
//{
	 
//}
//$.cookie('qid',1);
if($.cookie('qid') != '' && $.cookie('qid') != undefined && $.cookie('qid') != '-1' && $.cookie('qid') != -1) {
    
	var url = 'http://go.163.com/2014/0609/redbull/expinterface.php?act=shareMyboder&openid='+$.cookie('open');
    //$.cookie('openid');
    //alert($.cookie('openid'));
   // alert($.cookie('qid'));   
  //  var postData = 'tid=' + $.cookie('qid');
    $.ajax({
        type: "get",
        async: false,
        url: url,
      //  data: postData,
        dataType: "jsonp",
        jsonp: "callback",
        jsonpCallback: "jsonpcallback",
        success: function (data) {
        	if($.cookie('fw')==2)
        	{
        		alert(data.retData.num);
        	}
        	//alert(data.retData.num);
        	$("#cq").text(data.retData.num);
        	$("#nono").text('NO'+$.cookie('number'));
        	//return false;
        	//alert(data.retData.num);
        	var pp=1;
        }
    });
    
    var url = 'http://go.163.com/2014/0609/redbull/expinterface.php?act=getrankdata';
    //var url = '1.php';
    //$.cookie('openid');
    //alert($.cookie('openid'));
   // alert($.cookie('qid'));   
    var postData = 'tid=' + $.cookie('qid');
    $.ajax({
        type: "get",
        async: false,
        url: url,
        data: postData,
        dataType: "jsonp",
        jsonp: "callback",
       // jsonpCallback: "jsonpcallback",
        success: function (datas) {
            var map = new BMap.Map("allmap");
            var point = new BMap.Point(116.403891, 39.915198);
            map.centerAndZoom(point, 6);
          // for(var ke in datas){
        	//   alert(datas[ke].img);
        	//   return false;
          // }
           
            // var datas=[{"latitude":"39.938839","longitude":"116.529025","ismain":1,"img":"http:\/\/app.qlogo.cn\/mbloghead\/394c809c43784cd4cf9a\/50"},{"latitude":"25.127053","longitude":"121.491121","ismain":1,"img":"http:\/\/app.qlogo.cn\/mbloghead\/394c809c43784cd4cf9a\/50"}];
            // {"f":[{"latitude":"39.915198","longitude":"116.403891","ismain":1,"img":"http:\/\/app.qlogo.cn\/mbloghead\/394c809c43784cd4cf9a\/50"}],"j":[]}
            //alert(datas.f.length);
            for(var i in datas){
                /*if(datas.f.length-1==i)
                 {
                 var tx='';
                 }
                 else{
                 var tx=',';
                 }*/
                //var bei=new BMap.Point(datas.f[i].longitude,datas.f[i].latitude)+""+tx+"";
                //beijingPosition[i]=bei;
                //beijingPositions+=beijingPosition+""+i+""+""+tx+"";
                
                position.push(new BMap.Point(datas[i].longitude, datas[i].latitude));
                points[i] = position[i];
                	
                //hangzhouPosition=new BMap.Point(116.529025,39.938839),
                //taiwanPosition=new BMap.Point(121.491121,25.127053);
               

                //alert(datas.f[i].latitude);
                // alert(datas.f[i].longitude);
            }
            //alert(icon);
            //alert(beijingPositions);
            //var tr='';
            //for(ii=0;ii<beijingPosition.length;ii++)
            //{
            //	tr+=beijingPosition[ii];
            //}
            //var points = [hangzhouPosition,taiwanPosition];
            //alert(points);
            if (points.length > 1) {
			//	alert('jj');
                var curve = new BMap.Polyline(points, {strokeColor: "red", strokeWeight: 5, strokeOpacity: 0.9, strokeStyle: "dashed"}); //创建弧线对象
               
                map.panTo(new BMap.Point(datas[0].longitude, datas[0].latitude));
                map.addOverlay(curve);
                for(var p in datas){
                	 /*if(datas[p].ismain==1 || datas[p].ismain=='1')
                     {
                     var icon=datas[p].img.replace(/\\/,'');
                     //var icon="http://go.163.com/2014/0605/10010/images/top.jpg";
                     var ll=datas[p].longitude;
                     var lala=datas[p].latitude;
                     var icon = new BMap.Icon(icon, new BMap.Size(40, 40), {anchor: new BMap.Size(-10, 40)});
                     var mkr =new BMap.Marker(new BMap.Point(ll,lala),{icon: icon});
                    
                     map.addOverlay(mkr);
                     
                     }*/
                	var icon=datas[p].img.replace(/\\/,'');
                    var point = new BMap.Point(datas[p].longitude, datas[p].latitude);
                    map.centerAndZoom(point, 6);
                    var icon = new BMap.Icon(icon, new BMap.Size(40, 40), {anchor: new BMap.Size(-15, 20)});
                    var marker = new BMap.Marker(point);
                    var marker1 = new BMap.Marker(point,{icon: icon});  
                  //  map.panTo(new BMap.Point(datas[0].longitude, datas[0].latitude));
					setTimeout(function () {
                    // map.panTo(new BMap.Point(116.403891, 39.915198));   //两秒后移动到广州
                    map.setZoom(1);
                }, 1500);
                    map.addOverlay(marker1);
                    map.addOverlay(marker);
					
   
                }
            }
            else {
                //alert(datas);
                 //alert('qq');
                var icon=datas[0].img.replace(/\\/,'');
                var point = new BMap.Point(datas[0].longitude, datas[0].latitude);
                map.centerAndZoom(point, 20);
                var icon = new BMap.Icon(icon, new BMap.Size(40, 40), {anchor: new BMap.Size(-15, 20)});
                var marker = new BMap.Marker(point);
                var marker1 = new BMap.Marker(point,{icon: icon});  
                map.panTo(new BMap.Point(datas[0].longitude, datas[0].latitude));

                map.addOverlay(marker1);
                map.addOverlay(marker);    
                map.enableScrollWheelZoom();

                //marker.enableDragging();
              //  setTimeout(function () {
                    // map.panTo(new BMap.Point(116.403891, 39.915198));   //两秒后移动到广州
                 //   map.setZoom(20);
              //  }, 1500);
                	
            }

            //map.disableDoubleClickZoom();
            map.enableScrollWheelZoom();
            map.addControl(new BMap.NavigationControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT, type: BMAP_NAVIGATION_CONTROL_PAN}));
        }
    });
	//$.cookie('qid', -1);
}
else if($.cookie('types')==3 || $.cookie('types')=='3') {
    
   // alert('sd');
    var url='http://go.163.com/2014/0609/redbull/expinterface.php?act=getallroute';
    
    var postData = 'reqid=';
   
    $.ajax({
        type: "get",
        async: false,
        url: url,
        data: postData,
        dataType: "jsonp",
       jsonp: "callback",
        jsonpCallback:'jsonpcallback',
        success: function (datas) {
        	//alert(datas.length);
            var map = new BMap.Map("allmap");
            var point = new BMap.Point(116.403891, 39.915198);
            map.centerAndZoom(point, 6);
            
             //var datas=[[{"latitude":"29.07022","longitude":"110.51674","img":"http:\/\/app.qlogo.cn\/mbloghead\/f984f0cc086cdf4c6af0\/50"},{"latitude":"37.434659","longitude":"127.295073","img":"http:\/\/app.qlogo.cn\/mbloghead\/7d0becb4a2a7c08b1880\/50"}],[{"latitude":"39.896975","longitude":"116.333105","img":"http:\/\/app.qlogo.cn\/mbloghead\/64f83eb868c5c4e2f724\/50"}],[{"latitude":"30.66005","longitude":"104.119033","img":"http:\/\/app.qlogo.cn\/mbloghead\/394c809c43784cd4cf9a\/50"}],[{"latitude":"47.629239","longitude":"104.371691","img":"http:\/\/app.qlogo.cn\/mbloghead\/915ef1468274f404781c\/50"}],[{"latitude":"34.675612","longitude":"112.451621","img":"http:\/\/app.qlogo.cn\/mbloghead\/19ea017e18798cbfaa5e\/50"}],[{"latitude":"40.05671","longitude":"116.248635","img":"http:\/\/go.163.com\/2014\/0609\/redbull\/images\/user_tx.jpg"}],[{"latitude":"36.724388","longitude":"119.090676","img":"http:\/\/app.qlogo.cn\/mbloghead\/a80f3845637c9883a3a6\/50"}],[{"latitude":"46.8768","longitude":"127.495021","img":"http:\/\/app.qlogo.cn\/mbloghead\/cd37830ebaf98dd67184\/50"}],[{"latitude":"46.823156","longitude":"127.527216","img":"http:\/\/go.163.com\/2014\/0609\/redbull\/images\/user_tx.jpg"}],[{"latitude":"36.694987","longitude":"104.813709","img":"http:\/\/go.163.com\/2014\/0609\/redbull\/images\/user_tx.jpg"}],[{"latitude":"38.570823","longitude":"114.448493","img":"http:\/\/app.qlogo.cn\/mbloghead\/8e8d4ac2299e1cb1a4d4\/50"}],[{"latitude":"32.0907","longitude":"119.050961","img":"http:\/\/app.qlogo.cn\/mbloghead\/30275256e2458bbe1e32\/50"}],[{"latitude":"34.868684","longitude":"95.835696","img":"http:\/\/app.qlogo.cn\/mbloghead\/7d0becb4a2a7c08b1880\/50"}],[{"latitude":"26.653363","longitude":"107.503716","img":"http:\/\/app.qlogo.cn\/mbloghead\/cfde96a3ee5402431258\/50"}],[{"latitude":"29.867283","longitude":"120.802024","img":"http:\/\/app.qlogo.cn\/mbloghead\/a60d0c11e6716f252f7e\/50"}]];
            // alert(datas.length);
            // {"f":[{"latitude":"39.915198","longitude":"116.403891","ismain":1,"img":"http:\/\/app.qlogo.cn\/mbloghead\/394c809c43784cd4cf9a\/50"}],"j":[]}
            
            for (i=0;i<datas.length;i++) 
            {
            	for(j=0;j<datas[i].length;j++)
            		{
		               
		                position.push(new BMap.Point(datas[i][j].longitude, datas[i][j].latitude));
		                points[i] = position[i];
		               
               
            		}
		                
            }
          
            if (points.length > 1) 
            {
                var curve = new BMap.Polyline(points, {strokeColor: "red", strokeWeight: 5, strokeOpacity: 0.9, strokeStyle: "dashed"}); //创建弧线对象
               
                map.panTo(new BMap.Point(datas[0][0].longitude, datas[0][0].latitude));
                map.addOverlay(curve);
                for (i = 0; i < datas.length; i++) 
                {
                	for(j=0;j<datas[i].length;j++)
                		{
		                	 
		                	var icon=datas[i][j].img.replace(/\\/,'');
		                    var point = new BMap.Point(datas[i][j].longitude, datas[i][j].latitude);
		                    map.centerAndZoom(point, 6);
		                    var icon = new BMap.Icon(icon, new BMap.Size(40, 40), {anchor: new BMap.Size(-15, 20)});
		                    var marker = new BMap.Marker(point);
		                    var marker1 = new BMap.Marker(point,{icon: icon});  
		                  //  map.panTo(new BMap.Point(datas[0].longitude, datas[0].latitude));
		
		                    map.addOverlay(marker1);
		                    map.addOverlay(marker);
                		}
                }
            }
            else 
            {
                //alert('jj');
                var icon=datas[0].img.replace(/\\/,'');
                var point = new BMap.Point(datas[0].longitude, datas[0].latitude);
                map.centerAndZoom(point, 20);
                var icon = new BMap.Icon(icon, new BMap.Size(40, 40), {anchor: new BMap.Size(-15, 20)});
                var marker = new BMap.Marker(point);
                var marker1 = new BMap.Marker(point,{icon: icon});  
                map.panTo(new BMap.Point(datas[0].longitude, datas[0].latitude));

                map.addOverlay(marker1);
                map.addOverlay(marker);    
                map.enableScrollWheelZoom();
                //marker.enableDragging();
                setTimeout(function () {
                    // map.panTo(new BMap.Point(116.403891, 39.915198));   //两秒后移动到广州
                    map.setZoom(20);
                }, 1500);
            }

            //map.disableDoubleClickZoom();
            map.enableScrollWheelZoom();
            map.addControl(new BMap.NavigationControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT, type: BMAP_NAVIGATION_CONTROL_PAN}));
        }
    });
	$.cookie('types', -1);
}
else {
    //$.cookie('fqid',1);
    var url = 'http://go.163.com/2014/0609/redbull/expinterface.php?act=getmyboder';
//$.cookie('openid');
//alert($.cookie('openid'));
//alert('uid');
    var position1 = [];
    var points1 = [];
    var postData = 'openid=' + uid;
    $.ajax({
        type: "get",
        async: false,
        url: url,
        data: postData,
        dataType: "jsonp",
        jsonp: "callback",
        jsonpCallback: "jsonpcallback",
        success: function (datas) {
            var map = new BMap.Map("allmap");
            var point = new BMap.Point(116.403891, 39.915198);
            map.centerAndZoom(point, 8);

            // var datas={"f":[{"latitude":"39.915198","longitude":"116.403891","ismain":1,"img":""},{"latitude":"30.66005","longitude":"104.119033","ismain":1,"img":null}],"j":[]}
            // {"f":[{"latitude":"39.915198","longitude":"116.403891","ismain":1,"img":"http:\/\/app.qlogo.cn\/mbloghead\/394c809c43784cd4cf9a\/50"}],"j":[]}
            //alert(datas.f[0].longitude);
            for (i = 0; i < datas.f.length; i++) {
                /*if(datas.f.length-1==i)
                 {
                 var tx='';
                 }
                 else{
                 var tx=',';
                 }*/
                //var bei=new BMap.Point(datas.f[i].longitude,datas.f[i].latitude)+""+tx+"";
                //beijingPosition[i]=bei;
                //beijingPositions+=beijingPosition+""+i+""+""+tx+"";
                position.push(new BMap.Point(datas.f[i].longitude, datas.f[i].latitude));
                points[i] = position[i];
                //hangzhouPosition=new BMap.Point(116.529025,39.938839),
                //taiwanPosition=new BMap.Point(121.491121,25.127053);
                if (datas.f[i].ismain == 1 || datas.f[i].ismain == '1') {
                    if (datas.f[i].img != '' && datas.f[i].img != 'null' && datas.f[i].img != null) {
                        var icon = datas.f[i].img.replace(/\\/, '');
                    } else {
                        var icon = "./iconpng.png";
                    }
                    //var icon="http://go.163.com/2014/0605/10010/images/top.jpg";
                    var ll = datas.f[i].longitude;
                    var lala = datas.f[i].latitude;
                }
                if (datas.j.length > 0 && datas.j[i].longitude != '') {
                    position1.push(new BMap.Point(datas.j[i].longitude, datas.j[i].latitude));
                    points1[i] = position1[i];
                }
                //hangzhouPosition=new BMap.Point(116.529025,39.938839),
                //taiwanPosition=new BMap.Point(121.491121,25.127053);
                /*if(datas.j[i].ismain==1 || datas.j[i].ismain=='1')
                 {
                 var icon=datas.j[i].img.replace(/\\/,'');
                 //var icon="http://go.163.com/2014/0605/10010/images/top.jpg";
                 var ll=datas.j[i].longitude;
                 var lala=datas.j[i].latitude;
                 }*/

                //alert(datas.f[i].latitude);
                // alert(datas.f[i].longitude);
            }


            if (points.length > 1) {
                var curve = new BMap.Polyline(points, {strokeColor: "red", strokeWeight: 5, strokeOpacity: 0.9, strokeStyle: "dashed"}); //创建弧线对象
                if (datas.j.length > 0) {
                    var curves = new BMap.Polyline(points1, {strokeColor: "red", strokeWeight: 5, strokeOpacity: 0.9, strokeStyle: "dashed"});
                }
                var icon = new BMap.Icon(icon, new BMap.Size(40, 40), {anchor: new BMap.Size(30, 40)});
                var mkr = new BMap.Marker(new BMap.Point(ll, lala), {icon: icon});
                map.panTo(new BMap.Point(ll, lala));
                map.addOverlay(mkr);
                map.addOverlay(curve);
                if (datas.j.length > 0) {
                    map.addOverlay(curves);
                }
                map.setZoom(6);
            }

            else {
                if (datas.f[0].img != '' && datas.f[0].img != 'null' && datas.f[0].img != null) {
                    var icon = datas.f[0].img.replace(/\\/, '');
                } else {
                    var icon = "./iconpng.png";
                }
                //alert(datas.f[0].longitude);
                var point = new BMap.Point(datas.f[0].longitude, datas.f[0].latitude);
                map.centerAndZoom(point, 8);
                var icon = new BMap.Icon(icon, new BMap.Size(50, 50), {anchor: new BMap.Size(30, 40)});
                var marker = new BMap.Marker(point, {icon: icon});
                //var marker1 = new BMap.Marker(point,{icon: icon}); 
                //map.panTo({"lat:'"+datas.f[0].latitude+"'"+','+"lng:"+datas.f[0].longitude});
                map.panTo(new BMap.Point(datas.f[0].longitude, datas.f[0].latitude));
                map.addOverlay(marker);
                //map.addOverlay(marker1);    
                map.enableScrollWheelZoom();
                //marker.enableDragging();
                //setTimeout(function(){
                // map.panTo(new BMap.Point(116.403891, 39.915198));   //两秒后移动到广州
                //	map.setZoom(12);
                //}, 1500);
                map.setZoom(8);
            }
            //map.setZoom(6);
            //map.disableDoubleClickZoom();
            map.enableScrollWheelZoom(true);
            map.addControl(new BMap.NavigationControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT, type: BMAP_NAVIGATION_CONTROL_PAN}));
        }
    });
}
var trackScript1;
function limei(action, oclick, Cname, Fname) {
    var path = '';

    var temp = action;
    var limeiInfo = eval('(' + $.cookie('limeiInfo') + ')');
    var limeiUrl = "http://m.lmapp.com/dmplog.php?";
    var limeididid = limeiInfo.limeididid;
    var udid = limeiInfo.udid;
    var appid = limeiInfo.appid;
    var udidType = limeiInfo.udidType;
    var rs;

    if (action == "form" && Cname != '' && Cname != undefined && Cname != null) {
        rs = Math.random() * 100000;
        path = limeiUrl + "action=" + temp + "&limeididid=" + limeididid + "&udidType=" + udidType + "&udid=" + udid + "&appid=" + appid + "&form=" + form + "&r=" + rs;
    }
    else if (action == "submit" && Cname != '' && Cname != undefined && Cname != null && Fname != '' && Fname != undefined && Fname != null) {
        rs = Math.random() * 100000;
        path = limeiUrl + "action=" + temp + "&limeididid=" + limeididid + "&udidType=" + udidType + "&udid=" + udid + "&appid=" + appid + "&submit=" + submint + "&r=" + rs;
    }
    else if ((action == "access" || action == "loaded")) {
        rs = Math.random() * 100000;
        path = limeiUrl + "action=" + temp + "&limeididid=" + limeididid + "&udidType=" + udidType + "&udid=" + udid + "&appid=" + appid + "&r=" + rs;
    }
    else if (action == "click" && oclick != '' && oclick != undefined && oclick != null) {
        rs = Math.random() * 100000;
        path = limeiUrl + "action=" + temp + "&limeididid=" + limeididid + "&udidType=" + udidType + "&udid=" + udid + "&appid=" + appid + "&click=" + oclick + "&r=" + rs;
    }
//        document.getElementById("limei").src=path
    trackScript1 = document.createElement("script");
    trackScript1.type = "text/javascript";
    trackScript1.src = path;
    document.getElementsByTagName("head")[0].appendChild(trackScript1);
//    alert(path);
}
</script>
