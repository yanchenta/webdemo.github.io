<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0,  minimum-scale=1.0, maximum-scale=1.0" />
	<title>米其林携您体验保时捷极致之旅</title>
	<link rel="stylesheet" type="text/css" href="css/share_3_640_960.css"/>
	<link rel="stylesheet" type="text/css" href="css/share_3_720_1280.css" media="only screen and (min-width:720px)"/>
</head>
<body>
	<div class="banner"></div>
	<div class="main-body">
		<div class="div-form">
			<input class="input-name"/>
			<input class="input-phone"/>
			<div class="div-btn-submit"></div>
		</div>
	<div>
	<div class="footer"></div>
</body>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/ajaxes.js"></script>
<script type="text/javascript" src="js/trackEvent.js"></script>
<script type="text/javascript" src="js/trackConsts.js"></script>
<script type="text/javascript">

	window.onload = function(){
		track2(window.codeConsts.channelId, window.codeConsts.codes.page_share3_pv);
		
		if(!!document.getElementsByTagName("img")[0]){//hide baidu logo
			
			document.getElementsByTagName("img")[0].width = "1";
			document.getElementsByTagName("img")[0].height = "1";
			
			document.getElementsByTagName("img")[0].onload = function(){
				this.width = "1";
				this.height = "1";
			}
			
			setTimeout(function(){
				document.getElementsByTagName("img")[0].onload();
			},500);
		}
	}
	
	var uidIdx = window.location.href.indexOf("?uid=");
	var uid = "";
	if(uidIdx >= 0){
		uid = window.location.href.substring(uidIdx + 5);//获取回调的uid
	}
	else{
		window.location.href = "index.html";
	}
	
	var isInSubmit = false; //避免信息重新提交的BUG
	document.getElementsByClassName("div-btn-submit")[0].onclick = function(){
		if(isInSubmit) return;
		isInSubmit = true;
	
		track2(window.codeConsts.channelId, window.codeConsts.codes.page_share3_submit);
		
		//alert("模拟提交成功!");
		var input_name = document.getElementsByClassName("input-name")[0].value;
		var input_phone = document.getElementsByClassName("input-phone")[0].value;
		//姓名判断:
		if("" === input_name){
			alert("姓名不能为空!");
			isInSubmit = false;
			return;
		}
		if(!input_name.match(/^[a-z|A-Z|\u4e00-\u9fa5]{2,}$/)){
			alert("姓名格式不正确!");
			isInSubmit = false;
			return;
		}
		if(input_name.length > 10){
			alert('姓名位数不正确');
			isInSubmit = false;
			return;
		}
		
		
		//手机号码提示
		if(!input_phone.match(/^[0-9]{11}$/)){
			alert('请输入 11位手机号码');
			isInSubmit = false;
			return;
		}
		if(!input_phone.match(/^1[0-9]{10}$/)){
			alert('请输入正确的手机号码');
			isInSubmit = false;
			return;
		}
		
		//是否在手机前缀号码之中
		var matchFail = false;
		var phoneNumPrefixes = ["130", "131", "132", "133", "134", "135", "136", 
		"137", "138", "139", "145", "147", "150", "151", 
		"152", "153", "155", "156", "157", "158", "159", 
		"180", "181", "182", "183", "184", "185", "186", "187", "188", "189"];
		for(var i = 0; i < phoneNumPrefixes.length; i++){
			if(!!input_phone.match(/^(130)|(131)|(132)|(133)|(134)|(135)|(136)|(137)|(138)|(139)|(145)|(147)|(150)|(151)|(152)|(153)|(155)|(156)|(157)|(158)|(159)|(180)|(181)|(182)|(183)|(184)|(185)|(186)|(187)|(188)|(189)[0-9]{8}$/)){
				matchFail = true;
				break;
			}
		}
		if(!matchFail){
			alert('请输入正确的手机号码');
			isInSubmit = false;
			return;
		}
		
		
		//var advid = 20054;
		
		//var _url = "http://test.zhangkuo.net/michelin_adwo/michelin/share.action";
		var _url = "http://newcms.mobile1.com.cn/michelin/share.action";
		_url += "?realname=" + input_name;
		_url +=	"&mobile=" + input_phone;
		_url += "&uid=" + uid;
		
		ajax(_url, function(response){
			isInSubmit = false;
			
			if(!!response){
				if(1 === response.success){
					alert("提交成功！");
					window.location.href = "share_4.html";
				}
				else if(3 === response.success){
					alert("您使用的手机号码已参与过活动，不能再次使用！");
				}
				else{
					alert("提交失败！" + response.info);
				}
			}
		});
	}
	
</script>
</html>