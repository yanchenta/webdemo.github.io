<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0,  minimum-scale=1.0, maximum-scale=1.0" />
	<title>米其林</title>
	<link rel="stylesheet" type="text/css" href="css/buy_1_640_960.css"/>
	<link rel="stylesheet" type="text/css" href="css/buy_1_720_1280.css" media="only screen and (min-width:720px)"/>
</head>
<body>
	<div class="banner"></div>
	<div class="main-body">
		<div class="div-form">
			<input class="input-text-shopcode" type="text"/>
			<input class="input-text-name" type="text"/>
			<input class="input-text-phone" type="text"/>
			<input class="input-text-sellcode1" type="text"/>
			<input class="input-text-sellcode2" type="text"/>
			<div class="div-btn-submit" type="button"></div>
		</div>
		<div class="div-to-introduction" type="button"></div>
	</div>
	<div class="footer"></div>
</body>
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/ajaxes.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/trackEvent.js"></script>
<script type="text/javascript" src="js/trackConsts.js"></script>
<script type="text/javascript">
	
	var isInSubmit = false;//避免重复提交的标志量
	document.getElementsByClassName("div-btn-submit")[0].onclick = function(){
		if(isInSubmit) return;
		isInSubmit = true;
		
		track2(window.codeConsts.channelId, window.codeConsts.codes.page_buy1_click_submit);
		//window.location.href = "";
		
		//姓名验证/手机号码验证/短信验证
		var input_shopCode = document.getElementsByClassName("input-text-shopcode")[0].value;
		var input_name = document.getElementsByClassName("input-text-name")[0].value;
		var input_phone = document.getElementsByClassName("input-text-phone")[0].value;
		var input_selCode1 = document.getElementsByClassName("input-text-sellcode1")[0].value;
		var input_selCode2 = document.getElementsByClassName("input-text-sellcode2")[0].value;
		
		if("" === input_shopCode){
			alert("店面编码不能为空!");
			isInSubmit = false;
			return;
		}
		if(!input_shopCode.match(/^[0-9]{6}$/)){
			alert("店面编码的格式不正确！");
			isInSubmit = false;
			return;
		}
		
		//姓名判断:
		if("" === input_name){
			alert("姓名不能为空!");
			isInSubmit = false;
			return;
		}
		if(!input_name.match(/^[a-z|A-Z|\u4e00-\u9fa5]{2,}$/)){
			alert("姓名格式不正确!");
			isInSubmit = false;
			return;
		}
		if(input_name.length > 10){
			alert('姓名位数不正确');
			isInSubmit = false;
			return;
		}
		
		//手机号码提示
		if(!input_phone.match(/^[0-9]{11}$/)){
			alert('请输入 11位手机号码');
			isInSubmit = false;
			return;
		}
		if(!input_phone.match(/^1[0-9]{10}$/)){
			alert('请输入正确的手机号码');
			isInSubmit = false;
			return;
		}
		
		//是否在手机前缀号码之中
		var matchFail = false;
		var phoneNumPrefixes = ["130", "131", "132", "133", "134", "135", "136", 
		"137", "138", "139", "145", "147", "150", "151", 
		"152", "153", "155", "156", "157", "158", "159", 
		"180", "181", "182", "183", "184", "185", "186", "187", "188", "189"];
		for(var i = 0; i < phoneNumPrefixes.length; i++){
			if(!!input_phone.match(/^(130)|(131)|(132)|(133)|(134)|(135)|(136)|(137)|(138)|(139)|(145)|(147)|(150)|(151)|(152)|(153)|(155)|(156)|(157)|(158)|(159)|(180)|(181)|(182)|(183)|(184)|(185)|(186)|(187)|(188)|(189)[0-9]{8}$/)){
				matchFail = true;
				break;
			}
		}
		if(!matchFail){
			alert('请输入正确的手机号码');
			isInSubmit = false;
			return;
		}
		
		
		//请输入16位防伪码
		if(!input_selCode1.match(/^[0-9]{16}$/)){
			alert('请输入16位防伪码');
			isInSubmit = false;
			return;
		}
		
		if(!input_selCode2.match(/^[0-9]{16}$/)){
			alert('请输入16位防伪码');
			isInSubmit = false;
			return;
		}
		
		//防伪码不能相同
		if(input_selCode1 == input_selCode2){
			alert('必须使用两条不同的防伪码');
			isInSubmit = false;
			return;
		}
		
		//你所验证的防伪码已参与过活动，不能再次使用；
		//你验证的防伪码不存在
		//你所验证的防伪码首次验证时间为XX，不能参与此活动
		
		var advid = 20054;
		//var _url = 'http://test.zhangkuo.net/michelin_adwo/michelin/digitcode.action';
		var _url = "http://newcms.mobile1.com.cn/michelin/digitcode.action";
		_url += "?dlr_id=" + input_shopCode;
		_url += "&realname=" + input_name;
		_url +=	"&mobile=" + input_phone;
		_url += "&code1=" + input_selCode1;
		_url += "&code2=" + input_selCode2;
		//document.write(_url);
		//return;
		ajax(_url, function(response){
			//alert(response);
			isInSubmit = false;
			if(!!response){
				if(1 === response.success){
					alert("提交成功！");
					window.location.href = "buy_2.html";
				}
				else if(3 === response.success){
					alert("您使用的手机号码已参与过活动，不能再次使用！");
				}
				else{
					alert("提交失败！" + response.info);
				}
			}
		});
	};
	
	document.getElementsByClassName("div-to-introduction")[0].onclick = function(){
		var _url = "introduction.html";
		track2(window.codeConsts.channelId, window.codeConsts.codes.page_buy1_pv, _url);
	}
	
	window.onload = function(){
		track2(window.codeConsts.channelId, window.codeConsts.codes.page_buy1_pv);

		if(!!document.getElementsByTagName("img")[0]){//hide baidu logo
			
			document.getElementsByTagName("img")[0].width = "1";
			document.getElementsByTagName("img")[0].height = "1";
			
			document.getElementsByTagName("img")[0].onload = function(){
				this.width = "1";
				this.height = "1";
			}
			
			setTimeout(function(){
				document.getElementsByTagName("img")[0].onload();
			},500);
		}
	}
</script>
</html>