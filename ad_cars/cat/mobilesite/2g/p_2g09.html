<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<title>Cat®英雄俱乐部 - 卡特帮帮忙 - Cat（卡特）官网</title>
    <link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/p_2g09.css">
	<style type="text/css">
	.searchArea{
		position:fixed;
		bottom:30px;
		left:0px;
		width:640px;
		height:auto;
		z-index:20;
	}
	.searchControls{
		background-image:url('images/map-searchtype-bg.png');
		background-position:left bottom;
		background-repeat:no-repeat;
		background-size:640px 175px;	
		height:175px;
		width:640px;
		font-size:30px;
		color:white;
		font-weight:700;
		padding-top:40px;
		padding-left:60px;
	}
	.searchControls input[type=radio]{
		width:20px;
		height:20px;
		margin-top:20px;
	}
	.searchControls div{
		margin-top:20px;
		height:60px;
	}
	.searchControls select{
		width:150px;
		height:80px;
		
		font-size:30px;
		font-weight:700;
	}
	.searchControls span{
		margin-left:10px;
		margin-right:10px;
	}	
	.searchResults{
		width:640px;
		height:auto;
		background-color:white;		
		max-height:404px;
		overflow-y:hidden;
		overflow-x:hidden;		
		display:block;
	}
	.searchResultItem{
		width:640px;
		height:202px;	
		background-image:url('images/result-item-bg.jpg');
		background-size:640px 202px;
		background-position:left top;
		background-repeat:no-repeat;	
		position:relative;
	}
	.searchResultItem-index{
		color:#ffcd10;		
		position:absolute;
		left:39px;
		top:19px;	
		font-size:25px;
	}
	.searchResultItem-text1{
		color:#595959;	
		position:absolute;
		left:100px;
		top:10px;	
		font-size:20px;	
		width:500px;
		height:30px;	
		white-space:nowrap;
	}
	.searchResultItem-text2{
		color:#595959;		
		position:absolute;
		left:100px;
		top:50px;		
		font-size:20px;	
		width:60px;
		height:30px;
	}
	.searchResultItem-text3{
		color:#9c9c9c;		
		position:absolute;
		left:160px;
		top:50px;		
		font-size:20px;	
		width:440px;
		height:30px;	
		white-space:nowrap;
	}
	.searchResultItem-text4{
		color:#9c9c9c;
		position:absolute;
		left:100px;
		top:90px;	
		font-size:20px;	
		width:500px;
		height:30px;	
		white-space:nowrap;white-space:nowrap;
        overflow:hidden;text-overflow:ellipsis;
	}
	.div-btn-contactme{
		position:absolute;
		left:145px;
		top:130px;		
		width:230px;
		height:55px;		
		cursor:pointer;
	}
	.div-btn-sendmsg{
		position:absolute;
		left:380px;
		top:130px;		
		width:230px;
		height:55px;		
		cursor:pointer;
	}
	</style>
	<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="js/control.js"></script>
    <script type="text/javascript" src="js/delear2.js"></script>
	<script type="text/javascript" src="js/api.js"></script>
</head>
<body onload="resetPage()">
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-52VC42"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script src="../js/log.js"></script>
    <div class="frame">
        <div class="header" style="position: relative;">
            <a href="p_2g01.html" style="position:absolute;top:0;left:0;display:inline-block;width:300px;height:80px;"></a>
            <div class="logo">
                <div class="headermenu" style="width:330px;">
                    <a href="tel:4001115187" onclick="dataLayer.push({'event':'event','category':'全网','action':'销售热线','label':'上导航'});">查询热线</a>
                    <div class="unlogin-status" style="display:inline-block;width:180px;">
                        <a href="p_2g05.html">登录</a>
                        <a href="p_2g06.html">注册</a>
                    </div>
                    <div class="login-status" style="display:inline-block;width:180px;">
                        <div id="login-useName" style="display:inline-block;padding-left:30px;"></div>
                        <div onclick="javascript:logout();" style="display:inline-block;">注销</div>
                    </div>
                </div>
            </div>
            <div class="menu">
                经销商查询
                <a href="javascript:history.back()">&lt;返回</a>
            </div>
        </div>
        <div class="content">
            <div class="content_two" id="one"></div>
            <div class="content_three" id="two">
                <select name="###" id="" class="select-province"></select>
                <select name="###" id="" class="select-city">
                    <option value="">请选择</option>
                </select>
            </div>
            <div class="searchResults"></div>
        </div>
        <div class="footer">
            <div class="footer_one">
                <a href="p_2g01.html">首页</a>
                <a href="p_2g02.html">产品</a>
                <a href="p_2g12.html">帮帮忙</a>
                <a href="p_2g24.html" class="a">俱乐部</a>
            </div>
            <div class="footer_two">
                <a href="###" class="twog"></a>
                <a href="index.html"></a>
            </div>
            <div class="footer_three">© 2012 卡特彼勒保留所有权利</div>
        </div>
    </div>
</body>
<script type="text/javascript" >
    var sUserAgent = navigator.userAgent.toLowerCase();
    if (sUserAgent.indexOf("ucbrowser") == -1)
        includeLinkStyle("css/p_2g09_1.css");
	function resetPage() {
		var deviceWidth = document.documentElement.clientWidth,
		scale = deviceWidth/640;
		document.body.style.zoom = scale;
	}
	window.onresize = function(){
		resetPage();
	}
	
	function request(paras)
    { 
        var url = location.href; 
        var paraString = url.substring(url.indexOf("?")+1,url.length).split("&"); 
        var paraObj = {} 
        for (i=0; j=paraString[i]; i++){ 
            paraObj[j.substring(0,j.indexOf("=")).toLowerCase()] = j.substring(j.indexOf("=")+1,j.length); 
        } 
        var returnValue = paraObj[paras.toLowerCase()]; 
        if(typeof(returnValue)=="undefined"){ 
            return ""; 
        }else{ 
            return returnValue; 
        } 
    }
	
	
	
	function initSelectProvinces(){
		var provinces = document.getElementsByClassName("select-province")[0];
		
		//append:
		
		var option = document.createElement("option");
		option.value = "";
		option.innerHTML = "请选择";
		provinces.appendChild(option);
		
		for(var i = 0; i < dealers.length; i++){
			
			var option = document.createElement("option");
			option.value = dealers[i].t;
			option.innerHTML = dealers[i].t;
			provinces.appendChild(option);
		}
	}
	function initSelectCities(province){
		var optCities = document.getElementsByClassName("select-city")[0];
		document.getElementsByClassName("btn-hide-results")[0]
		
		//clear:
		for(var i = optCities.childNodes.length - 1; i >= 0; i--){
			optCities.removeChild(optCities.childNodes[i]);
		}
		
		//append:
		var option = document.createElement("option");
		option.value = "";
		option.innerHTML = "请选择";
		optCities.appendChild(option);
		
		
		for(var i = 0; i < dealers.length; i++){
			if(province == dealers[i].t){
				var cities = dealers[i].s;
				for(var j = 0; j < cities.length; j++){
					var option = document.createElement("option");
					option.value = cities[j].t;
					option.innerHTML = cities[j].t;
					optCities.appendChild(option);
				}
				break;
			}
		}
	}
	
	
	function initSelectDelears(province, city){
		var optDelears = document.getElementsByClassName("searchResults")[0];
		
		//clear:
		for(var i = optDelears.childNodes.length - 1; i >= 0; i--){
			optDelears.removeChild(optDelears.childNodes[i]);
		}
		
		//append:
		for(var i = 0; i < dealers.length; i++){
			//alert(dealers[i].s + "," + province);
			if(province == dealers[i].t){
				var cities = dealers[i].s;
				//alert(dealers[i].t);
				for(var j = 0; j < cities.length; j++){
					if(city == cities[j].t){
						var delears = cities[j].d;
						//alert(dealers[i].t);
						for(var k = 0; k < delears.length; k++){
							//alert(delears[k].d);
							var option = document.createElement("div");
							option.className = "searchResultItem";
							
							var optSub1 = document.createElement("div");
							optSub1.className = "searchResultItem-index";
							optSub1.innerHTML = (k + 1);
							option.appendChild(optSub1);
							
							var optSub2 = document.createElement("div");
							optSub2.className = "searchResultItem-text1";
							optSub2.innerHTML = delears[k].name;
							option.appendChild(optSub2);
							
							var optSub3 = document.createElement("div");
							optSub3.className = "searchResultItem-text2";
							optSub3.innerHTML = "地址:";
							option.appendChild(optSub3);
							
							var optSub4 = document.createElement("div");
							optSub4.className = "searchResultItem-text3";
							optSub4.innerHTML = delears[k].address;
							option.appendChild(optSub4);
							
							var optSub5 = document.createElement("div");
							optSub5.className = "searchResultItem-text4";
							optSub5.innerHTML = "提供服务: " + delears[k].services;
							option.appendChild(optSub5);
							
							var optSub5 = document.createElement("div");
                            
							optSub5.className = "div-btn-contactme";
							optSub5.onclick = function(){
								autoXunjia()
                                return
								var user = getUser();
								if(!user){
									showReg();
									return;
								}
								window.location.href = "p_2g06.html";
							}
							option.appendChild(optSub5);
							
							var optSub6 = document.createElement("div");
							optSub6.className = "div-btn-sendmsg";
                            optSub6.dataset.address  = delears[k].name + delears[k].address;
							optSub6.onclick = function(){
								//alert(6);
								/*if(null == document.cookie || "" == document.cookie){
									document.getElementsByClassName("loginForm")[0].style.display = "block";
									return;
								}*/
								var user = getUser();
								if(!user){
									window.location.href = "p_2g06.html";
									return;
								}
                                $.get("http://test.zhangkuo.net/advmessage/adv/addResultJsonP.action?advid=20064&mobile="+user.mobile+"&description=" + this.dataset.address)
								alert("短信已发送成功！");
							}
							option.appendChild(optSub6);
							
							optDelears.appendChild(option);
						}
						break;
					}
				}
				break;
			}
		}
	}
	
	function getNearbyCityDelears(curLoc){
		//delearLoc.lng
		//delearLoc.lat
		var minDis = 10000;
		
		var nearbyi = 0;
		var nearbyj = 0;
		var nearbyk = 0;
		
		for(var i = 0; i < dealers.length; i++){
			var cities = dealers[i].s;
			for(var j = 0; j < cities.length; j++){
				var delears = cities[j].d;
				for(var k = 0; k < delears.length; k++){
					var dis = Math.sqrt(Math.pow(delears[k].lng - curLoc.lng, 2) + Math.pow(delears[k].lat - curLoc.lat, 2));
					if(dis < minDis){
						minDis = dis;
						
						nearbyi = i;
						nearbyj = j;
						nearbyk = k;
					}
				}
			}
		}
		
		var nearbyCity = dealers[nearbyi].s[nearbyj];
		var nearbyDelear = dealers[nearbyi].s[nearbyj].d[nearbyk];
		var rlt = {
			city:nearbyCity,
			delear:nearbyDelear,
			loc:curLoc
		}
		return rlt;
	}
	
	function getNearbyCityDelears2(cityName){
		var nearbyi = 0;
		var nearbyj = 0;
		
		var isFound = false;
		var rlt = null;
		for(var i = 0; i < dealers.length; i++){
			var cities = dealers[i].s;
			for(var j = 0; j < cities.length; j++){
				if(cityName == cities[j].t) {
					rlt = {
						city:cities[j],
						delear:null,
						loc:null
					};
					break;
				}
			}
			if(isFound) break;
		}
		
		return rlt;
	}
	
	initSelectProvinces();
	document.getElementsByClassName("select-province")[0].onchange = function(){
		initSelectCities(this.value);
	};
	
	document.getElementsByClassName("select-city")[0].onchange = function(){
		var province = document.getElementsByClassName("select-province")[0].value;
		var city = this.value;
		initSelectDelears(province, city);
		
		var provinces = document.getElementsByClassName("select-province")[0];
		if(provinces.childNodes.length > 0){
			var optDelears = document.getElementsByClassName("searchResults")[0];
			optDelears.style.display = "block";
			
		}
		
		//...
		var cityName = this.value;
		if("" != cityName){
			var rlt = getNearbyCityDelears2(cityName);
			//alert(rlt.city.t);
			
			setMap(rlt.city.d[0], rlt.city.d);
		}
	};
</script>
</html>